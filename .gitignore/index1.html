<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Inventory Management</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #0f172a;
      font-family: 'Segoe UI', sans-serif;
      color: white;
      overflow-x: hidden;
    }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen">

  <!-- ðŸŽ¨ Enhanced Animated Rectangular Background -->
  <svg class="absolute top-0 left-0 w-full h-full -z-10 opacity-20" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="#0ea5e9" />
        <stop offset="100%" stop-color="#8b5cf6" />
      </linearGradient>
    </defs>
    <rect x="5%" y="10%" width="140" height="70" rx="12" fill="url(#bgGradient)">
      <animate attributeName="x" values="5%;8%;5%" dur="7s" repeatCount="indefinite" />
      <animate attributeName="y" values="10%;14%;10%" dur="10s" repeatCount="indefinite" />
    </rect>
    <rect x="80%" y="70%" width="160" height="80" rx="14" fill="url(#bgGradient)">
      <animate attributeName="x" values="80%;77%;80%" dur="11s" repeatCount="indefinite" />
      <animate attributeName="y" values="70%;74%;70%" dur="8s" repeatCount="indefinite" />
    </rect>
    <rect x="40%" y="35%" width="130" height="65" rx="10" fill="url(#bgGradient)" opacity="0.6">
      <animate attributeName="x" values="40%;42%;40%" dur="14s" repeatCount="indefinite" />
      <animate attributeName="y" values="35%;38%;35%" dur="11s" repeatCount="indefinite" />
    </rect>
    <rect x="20%" y="80%" width="100" height="50" rx="8" fill="url(#bgGradient)" opacity="0.7">
      <animate attributeName="x" values="20%;23%;20%" dur="9s" repeatCount="indefinite" />
      <animate attributeName="y" values="80%;77%;80%" dur="13s" repeatCount="indefinite" />
    </rect>
    <rect x="65%" y="15%" width="150" height="75" rx="14" fill="url(#bgGradient)" opacity="0.5">
      <animate attributeName="x" values="65%;62%;65%" dur="10s" repeatCount="indefinite" />
      <animate attributeName="y" values="15%;19%;15%" dur="10s" repeatCount="indefinite" />
    </rect>
    <rect x="30%" y="60%" width="130" height="70" rx="12" fill="url(#bgGradient)" opacity="0.5">
      <animate attributeName="x" values="30%;33%;30%" dur="8s" repeatCount="indefinite" />
      <animate attributeName="y" values="60%;63%;60%" dur="12s" repeatCount="indefinite" />
    </rect>
    <!-- <rect x="10%" y="5%" width="140" height="70" rx="12" fill="url(#bgGradient)">
      <animate attributeName="x" values="5%;8%;5%" dur="7s" repeatCount="indefinite" />
      <animate attributeName="y" values="10%;14%;10%" dur="10s" repeatCount="indefinite" />
    </rect>
    <rect x="5%" y="10%" width="70" height="140" rx="12" fill="url(#bgGradient)">
      <animate attributeName="x" values="5%;8%;5%" dur="7s" repeatCount="indefinite" />
      <animate attributeName="y" values="10%;14%;10%" dur="10s" repeatCount="indefinite" />
    </rect> -->
  </svg>

  <!-- ðŸ” LOGIN PAGE -->
  <!-- <div id="loginSection" class="w-full max-w-md mx-auto mt-12 p-6 bg-white/10 rounded-lg shadow-md">
    <h1 class="text-3xl font-bold mb-4 text-center">Login</h1>
    <input id="loginUsername" type="text" placeholder="Username" class="w-full p-2 mb-3 rounded text-black">
    <input id="loginPassword" type="password" placeholder="Password" class="w-full p-2 mb-3 rounded text-black">
    <button onclick="loginUser()" class="w-full bg-blue-500 py-2 rounded hover:bg-blue-600">Login</button>
    <p class="text-sm text-center mt-2">Don't have an account?
      <a href="#" onclick="toggleSection('register')" class="text-blue-300 underline">Register here</a>
    </p>
  </div> -->

<div id="loginSection" class="hidden w-full max-w-md mx-auto mt-12 p-6 bg-white/10 rounded-lg shadow-md">
    <h1 class="text-3xl font-bold mb-4 text-center">Login</h1>
    <input id="loginUsername" type="text" placeholder="Username" class="w-full p-2 mb-3 rounded text-black">
    <input id="loginPassword" type="password" placeholder="Password" class="w-full p-2 mb-3 rounded text-black">
    <button id="loginBtn" type="button" class="w-full bg-green-500 py-2 rounded hover:bg-green-600">Login</button>
    <p class="text-sm text-center mt-2">Don't have an account? 
      <a href="#" onclick="toggleSection('register')" class="text-blue-300 underline">Register here</a>
    </p>
</div>


  <!-- ðŸ“ REGISTRATION PAGE -->
  <!-- <div id="registerSection" class="hidden w-full max-w-md mx-auto mt-12 p-6 bg-white/10 rounded-lg shadow-md">
    <h1 class="text-3xl font-bold mb-4 text-center">Register</h1>
    <input id="regUsername" type="text" placeholder="Username" class="w-full p-2 mb-3 rounded text-black">
    <input id="regPassword" type="password" placeholder="Password" class="w-full p-2 mb-3 rounded text-black">
    <button type="button" button onclick="registerUser()" class="w-full bg-blue-500 py-2 rounded hover:bg-blue-600">Register</button> -->
       <!-- <button type="button" onclick="registerUser()">Register</button> -->
    <!-- <p class="text-sm text-center mt-2">Already registered?
      <a href="#" onclick="toggleSection('login')" class="text-blue-300 underline">Login here</a>
    </p>
  </div> -->

<div id="registerSection" class="hidden w-full max-w-md mx-auto mt-12 p-6 bg-white/10 rounded-lg shadow-md">
    <h1 class="text-3xl font-bold mb-4 text-center">Register</h1>
    <input id="regUsername" type="text" placeholder="Username" class="w-full p-2 mb-3 rounded text-black">
    <input id="regPassword" type="password" placeholder="Password" class="w-full p-2 mb-3 rounded text-black">
    <button id="registerBtn" type="button" class="w-full bg-blue-500 py-2 rounded hover:bg-blue-600">Register</button>
    <p class="text-sm text-center mt-2">Already registered?
      <a href="#" onclick="toggleSection('login')" class="text-blue-300 underline">Login here</a>
    </p>
</div>


  <!-- ðŸ  HOME PAGE -->
  <div id="homeSection" class="hidden w-full max-w-5xl mx-auto mt-10 px-4">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-3xl font-bold">Inventory Detection</h2>
      <button onclick="logout()" class="bg-indigo-500 px-4 py-2 rounded hover:bg-indigo-600">Logout</button>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- ðŸ“¤ Upload -->
      <div class="bg-white/10 p-6 rounded-lg shadow-md">
        <label class="block mb-2">Upload an image</label>
        <input type="file" id="uploadBtn" accept="image/*" class="w-full-indigo-mb-4">
        <img id="imagePreview" class="hidden mt-4 w-full max-h-80 object-contain bg-white rounded" />
        <button id="predictBtn" class="w-full mt-4 bg-indigo-500 py-2 rounded hover:bg-indigo-600">Detect Objects</button>
      </div>

      <!-- ðŸŽ¥ Webcam -->
      <div class="bg-white/10 p-6 rounded-lg shadow-md">
        <label class="block mb-2">Webcam</label>
        <video id="webcam" autoplay playsinline class="w-full rounded mb-4"></video>
        <button id="captureBtn" class="w-full bg-indigo-500 py-2 rounded hover:bg-indigo-600">Capture & Detect</button>
      </div>
    </div>
    
<!-- Upload New Image -->
    <!-- <div class="upload-section">
    <h2>Add New Image</h2>
    <input type="file" id="newImageInput" accept="image/*" multiple>
    <button id="uploadNewImageBtn">Upload Image</button>
    <p id="uploadStatus"></p>
    </div> -->
    <h3>Add New Images</h3>
<input type="file" id="newImageInput" accept="image/*" multiple>
<button id="uploadNewImageBtn">Upload Images</button>
<p id="uploadStatus"></p>
<div id="uploadedImages"></div>
<div id="uploaded-files" style="margin-top: 20px;"></div>
<div id="prediction-results" style="margin-top:20px;"></div>

<!-- <div>
    <span>${filename}</span>
    <button onclick="detectImage('${filename}')">Detect</button>
</div> -->

<!-- //close -->



    <!-- ðŸ“Š Results -->
    <div class="mt-10 bg-white/10 p-6 rounded-lg shadow-md">
      <h3 class="text-xl font-semibold mb-4">Prediction Results</h3>
      <pre id="results" class="text-green-300 whitespace-pre-wrap">Results will appear here...</pre>
    </div>
  </div>

  <!-- ðŸ§  SCRIPT -->
  <script>
    const loginSection = document.getElementById('loginSection');
    const registerSection = document.getElementById('registerSection');
    const homeSection = document.getElementById('homeSection');

    function toggleSection(section) {
      loginSection.classList.add('hidden');
      registerSection.classList.add('hidden');
      homeSection.classList.add('hidden');

      if (section === 'login') loginSection.classList.remove('hidden');
      else if (section === 'register') registerSection.classList.remove('hidden');
      else if (section === 'home') homeSection.classList.remove('hidden');
    }

    // async function registerUser() {
    //   const username = document.getElementById('regUsername').value;
    //   const password = document.getElementById('regPassword').value;
    //   const res = await fetch('http://127.0.0.1:8000/register', {
    //     method: 'POST',
    //     headers: { 'Content-Type': 'application/json' },
    //     body: JSON.stringify({ username, password })
    //   });
    //   if (res.ok) {
    //     alert('Registered!');
    //     toggleSection('login');
    //   } else {
    //     alert('Registration failed.');
    //   }
    // }

//     async function registerUser() {
//     const email = document.getElementById("email").value;
//     const password = document.getElementById("password").value;

//     const response = await fetch("/register", {
//         method: "POST",
//         headers: {
//             "Content-Type": "application/json"
//         },
//         body: JSON.stringify({ email, password }) // must match FastAPI schema
//     });

//     if (response.ok) {
//         alert("Registered successfully");
//     } else {
//         const err = await response.json();
//         alert("Register failed: " + JSON.stringify(err));
//     }
// }


// async function registerUser() {
//     const full_name = document.getElementById('full_name').value;
//     const email = document.getElementById('email').value;
//     const password = document.getElementById('password').value;

//     const payload = {
//         full_name: full_name,
//         email: email,
//         password: password
//     };

//     try {
//         const res = await fetch('http://127.0.0.1:8000/auth/register', {
//             method: 'POST',
//             headers: { 'Content-Type': 'application/json' },
//             body: JSON.stringify(payload)
//         });

//         if (!res.ok) {
//             const error = await res.json();
//             alert('Register failed: ' + JSON.stringify(error));
//             return;
//         }

//         const data = await res.json();
//         alert('Registered successfully: ' + data.email);
//     } catch (err) {
//         console.error(err);
//         alert('Error: ' + err.message);
//     }
// }

document.getElementById('registerBtn').addEventListener('click', async function () {
    const username = document.getElementById('regUsername').value.trim();
    const password = document.getElementById('regPassword').value.trim();

    if (!username || !password) {
        alert('Please enter username and password.');
        return;
    }

    try {
        const response = await fetch('http://127.0.0.1:8000/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });

        if (response.ok) {
            alert('Registration successful!');
            toggleSection('login'); // Switch to login section
        } else {
            const errorData = await response.json();
            alert(`Register failed: ${errorData.detail}`);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Something went wrong. Check console for details.');
    }
});


document.getElementById('loginBtn').addEventListener('click', async function () {
    const username = document.getElementById('loginUsername').value.trim();
    const password = document.getElementById('loginPassword').value.trim();

    if (!username || !password) {
        alert('Please enter username and password.');
        return;
    }

    try {
        const response = await fetch('http://127.0.0.1:8000/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });

        if (response.ok) {
            const data = await response.json();
            alert('Login successful!');
            
            // If you are using JWT, save the token
            if (data.access_token) {
                localStorage.setItem('token', data.access_token);
            }

            // Show home section or redirect
            toggleSection('home');
        } else {
            const errorData = await response.json();
            alert(`Login failed: ${errorData.detail}`);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Something went wrong. Check console for details.');
    }
});


    // async function loginUser() {
    //   const username = document.getElementById('loginUsername').value;
    //   const password = document.getElementById('loginPassword').value;
    //   const formData = new URLSearchParams();
    //   formData.append('username', username);
    //   formData.append('password', password);

    //   const res = await fetch('http://127.0.0.1:8000/token', {
    //     method: 'POST',
    //     headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    //     body: formData
    //   });

    //   if (res.ok) {
    //     const data = await res.json();
    //     localStorage.setItem('token', data.access_token);
    //     toggleSection('home');
    //   } else {
    //     alert('Login failed.');
    //   }
    // }

async function registerUser() {
    const full_name = document.getElementById('full_name').value;
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;

    const response = await fetch('http://127.0.0.1:8000/auth/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            full_name: full_name,
            email: email,
            password: password
        })
    });

    const data = await response.json();
    if (response.ok) {
        alert('Registered successfully: ' + data.email);
    } else {
        alert('Register failed: ' + JSON.stringify(data));
    }
}

async function loginUser() {
    const email = document.getElementById('login_email').value;
    const password = document.getElementById('login_password').value;

    const formData = new URLSearchParams();
    formData.append('username', email);
    formData.append('password', password);

    const response = await fetch('http://127.0.0.1:8000/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: formData
    });

    const data = await response.json();
    if (response.ok) {
        localStorage.setItem('token', data.access_token);
        alert('Login successful!');
    } else {
        alert('Login failed: ' + JSON.stringify(data));
    }
}


    function logout() {
      localStorage.removeItem('token');
      // Clear login input fields
      document.getElementById("loginUsername").value = "";
      document.getElementById("loginPassword").value = "";
      toggleSection('login');
    }

// Upload New Image
// document.getElementById("uploadNewImageBtn").addEventListener("click", function () {
//     const fileInput = document.getElementById("newImageInput");
//     const statusText = document.getElementById("uploadStatus");

//     if (!fileInput.files.length) {
//         statusText.textContent = "Please select at least one image.";
//         return;
//     }

//     const formData = new FormData();
//     for (let i = 0; i < fileInput.files.length; i++) {
//         formData.append("files", fileInput.files[i]);
//     }

//     fetch("http://127.0.0.1:8000/add-images", {
//         method: "POST",
//         headers: {
//             Authorization: `Bearer ${localStorage.getItem("token")}`
//         },
//         body: formData
//     })
//     .then(response => response.json())
//     .then(data => {
//         if (data.status === "success") {
//             statusText.textContent = data.message;
//         } else {
//             statusText.textContent = "Error: " + data.message;
//         }
//     })
//     .catch(error => {
//         statusText.textContent = "Upload failed: " + error.message;
//     });
// });
document.getElementById("uploadNewImageBtn").addEventListener("click", function () {
    const fileInput = document.getElementById("newImageInput");
    const statusText = document.getElementById("uploadStatus");

    if (!fileInput.files.length) {
        statusText.textContent = "Please select at least one image.";
        return;
    }

    const formData = new FormData();
    for (let i = 0; i < fileInput.files.length; i++) {
        formData.append("files", fileInput.files[i]);
    }

    fetch("http://127.0.0.1:8000/add-images", {
        method: "POST",
        headers: {
            Authorization: `Bearer ${localStorage.getItem("token")}`
        },
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === "success") {
            statusText.textContent = data.message;
            data.files.forEach(filename => addUploadedImage(filename));
        } else {
            statusText.textContent = "Error: " + data.message;
        }
    })
    .catch(error => {
        statusText.textContent = "Upload failed: " + error.message;
    });
});

// update
const API_BASE = "http://127.0.0.1:8000";
// closeupdate

// function addUploadedImage(filename) {
//     const container = document.getElementById("uploadedImages");
//     const div = document.createElement("div");
//     div.innerHTML = `
//         <p>${filename}</p>
//         <button onclick="detectUploaded('${filename}')">Detect</button>
//     `;
//     container.appendChild(div);
// }
function addUploadedImage(filename) {
    const container = document.getElementById("uploadedImages");
    const div = document.createElement("div");
    div.id = `uploaded-${filename}`;
    div.style.border = "1px solid #ccc";
    div.style.margin = "10px";
    div.style.padding = "10px";
    div.innerHTML = `
        <p><strong>${filename}</strong></p>
        <button onclick="detectUploaded('${filename}')">Detect</button>
        <div class="result" style="margin-top:10px;"></div>
    `;
    container.appendChild(div);
}
function displayUploadedFiles(files) {
    const fileList = document.getElementById('uploaded-files');
    fileList.innerHTML = "";

    files.forEach(filename => {
        const container = document.createElement('div');
        container.style.margin = "10px";
        container.style.padding = "10px";
        container.style.border = "1px solid #ccc";
        container.style.display = "flex";
        container.style.justifyContent = "space-between";
        container.style.alignItems = "center";

        const nameSpan = document.createElement('span');
        nameSpan.textContent = filename;

        const detectBtn = document.createElement('button');
        detectBtn.textContent = "Detect";
        detectBtn.style.cursor = "pointer";
        detectBtn.onclick = () => detectImage(filename);

        container.appendChild(nameSpan);
        container.appendChild(detectBtn);
        fileList.appendChild(container);
    });
}




// function detectUploaded(filename) {
//     fetch("http://127.0.0.1:8000/predict-uploaded", {
//         method: "POST",
//         headers: {
//             "Content-Type": "application/json",
//             Authorization: `Bearer ${localStorage.getItem("token")}`
//         },
//         body: JSON.stringify({ filename })
//     })
//     .then(res => res.json())
//     .then(data => {
//         if (data.status === "success") {
//             alert("Detected objects: " + data.detections.map(d => d.class).join(", "));
//         } else {
//             alert("Error: " + data.message);
//         }
//     })
//     .catch(err => console.error("Error:", err));
// }
// function detectUploaded(filename) {
//     fetch("http://127.0.0.1:8000/predict-uploaded", {
//         method: "POST",
//         headers: {
//             "Content-Type": "application/json",
//             Authorization: `Bearer ${localStorage.getItem("token")}`
//         },
//         body: JSON.stringify({ filename })
//     })
//     .then(res => res.json())
//     .then(data => {
//         const container = document.querySelector(`#uploaded-${filename}`);
//         if (data.status === "success") {
//             let html = `
//                 <h4>Detection Results:</h4>
//                 <img src="http://127.0.0.1:8000${data.image_url}" alt="Detected Image" style="max-width:300px; display:block; margin-top:10px;">
//                 <ul>
//             `;
//             data.detections.forEach(det => {
//                 html += `<li>${det.class} - Confidence: ${(det.confidence * 100).toFixed(2)}%</li>`;
//             });
//             html += "</ul>";
//             container.querySelector(".result").innerHTML = html;
//         } else {
//             container.querySelector(".result").innerHTML = `<p style="color:red;">${data.message}</p>`;
//         }
//     })
//     .catch(err => console.error("Error:", err));
// }
// function detectImage(filename) {
//     fetch('/predict-uploaded', {
//         method: 'POST',
//         headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
//         body: new URLSearchParams({ 'filename': filename })
//     })
//     .then(response => response.json())
//     .then(data => {
//         const resultsDiv = document.getElementById('prediction-results');

//         if (data.status === "failed") {
//             resultsDiv.innerHTML = `<p style="color:red;">${data.message}</p>
//                                      <img src="${data.image_url}" style="max-width:300px;margin-top:10px;">`;
//             return;
//         }

//         if (data.status === "success") {
//             let resultHTML = `<img src="${data.image_url}" style="max-width:300px;display:block;margin-bottom:10px;">`;
//             resultHTML += "<ul>";
//             data.predictions.forEach(pred => {
//                 resultHTML += `<li>${pred.class} - ${pred.confidence}%</li>`;
//             });
//             resultHTML += "</ul>";

//             resultsDiv.innerHTML = resultHTML;
//         }
//     })
//     .catch(err => console.error('Error:', err));
// }
function detectUploaded(filename) {
    const container = document.querySelector(`#uploaded-${filename} .result`);
    container.innerHTML = "<p style='color:blue;'>Detecting...</p>";

    fetch("http://127.0.0.1:8000/predict-uploaded", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${localStorage.getItem('token')}`
        },
        body: JSON.stringify({ filename })
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === "success") {
            let html = `
                <h4>Detection Results:</h4>
                <img src="http://127.0.0.1:8000${data.image_url}" alt="Detected Image" style="max-width:300px; display:block; margin-top:10px;">
                <ul>`;
            data.detections.forEach(det => {
                html += `<li>${det.class} - Confidence: ${(det.confidence * 100).toFixed(2)}%</li>`;
            });
            html += "</ul>";
            container.innerHTML = html;
        } else {
            container.innerHTML = `<p style="color:red;">${data.message}</p>`;
        }
    })
    .catch(err => {
        container.innerHTML = `<p style="color:red;">Error: ${err.message}</p>`;
    });
}


function displayUploadedFiles(files) {
    const fileList = document.getElementById('uploaded-files');
    fileList.innerHTML = "";

    files.forEach(filename => {
        const container = document.createElement('div');
        container.id = `uploaded-${filename}`;
        container.style.margin = "10px";
        container.style.padding = "10px";
        container.style.border = "1px solid #ccc";

        container.innerHTML = `
            <strong>${filename}</strong>
            <button style="margin-left:10px; cursor:pointer;" onclick="detectUploaded('${filename}')">Detect</button>
            <div class="result" style="margin-top:10px;"></div>
        `;

        fileList.appendChild(container);
    });
}





// close



    const uploadBtn = document.getElementById("uploadBtn");
    const imagePreview = document.getElementById("imagePreview");
    const predictBtn = document.getElementById("predictBtn");
    const resultsBox = document.getElementById("results");
    let currentFile = null;

    uploadBtn.addEventListener("change", () => {
      const file = uploadBtn.files[0];
      if (!file) return;
      currentFile = file;
      const reader = new FileReader();
      reader.onload = function (e) {
        imagePreview.src = e.target.result;
        imagePreview.classList.remove("hidden");
      };
      reader.readAsDataURL(file);
    });

    predictBtn.addEventListener("click", async () => {
      if (!currentFile) return alert("Upload an image first.");
      const formData = new FormData();
      formData.append("file", currentFile);

      const res = await fetch("http://127.0.0.1:8000/predict", {
        method: "POST",
        headers: { Authorization: "Bearer " + localStorage.getItem("token") },
        body: formData
      });
      const data = await res.json();
      const formattedResults = (data.results || data).map((item, index) => {
  return `
      
        Class: ${item.class}
        Confidence Score: ${(item.score * 100).toFixed(2)}%
        Bounding Box: ${item.bbox.map(n => n.toFixed(2)).join(", ")}
        Description: ${item.description}
        Use: ${item.use}
        Price: ${item.price}
        Location: ${item.location}
        `;
        }).join("\n\n");

        resultsBox.textContent = formattedResults;

      
    });

    const webcam = document.getElementById("webcam");
    const captureBtn = document.getElementById("captureBtn");

    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        webcam.srcObject = stream;
      }).catch(err => console.error("Webcam error:", err));

    captureBtn.addEventListener("click", () => {
      const canvas = document.createElement("canvas");
      canvas.width = webcam.videoWidth;
      canvas.height = webcam.videoHeight;
      canvas.getContext("2d").drawImage(webcam, 0, 0);
      canvas.toBlob(async blob => {
        const formData = new FormData();
        formData.append("file", blob, "capture.jpg");

        const res = await fetch("http://127.0.0.1:8000/predict", {
          method: "POST",
          headers: { Authorization: "Bearer " + localStorage.getItem("token") },
          body: formData
        });
        const data = await res.json();
        const formattedResults = (data.results || data).map((item, index) => {
  return `

Class: ${item.class}
Confidence Score: ${(item.score * 100).toFixed(2)}%
Bounding Box: ${item.bbox.map(n => n.toFixed(2)).join(", ")}
Description: ${item.description}
Use: ${item.use}
Price: ${item.price}
Location: ${item.location}
`;
}).join("\n\n");

resultsBox.textContent = formattedResults;

      }, "image/jpeg");
    });

    toggleSection('login');
  </script>
</body>
</html>
